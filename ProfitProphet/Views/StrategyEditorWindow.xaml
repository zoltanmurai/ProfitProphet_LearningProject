<Window x:Class="ProfitProphet.Views.StrategyEditorWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:converters="clr-namespace:ProfitProphet.Converters"
        mc:Ignorable="d"
        Title="Stratégia Szerkesztő (Profi Mód)" Height="700" Width="1200"
        WindowStartupLocation="CenterScreen"
        Background="#1E1E1E" Foreground="White">

    <Window.Resources>
        <converters:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
        <converters:InverseBoolToVisibilityConverter x:Key="InverseBoolToVisibilityConverter"/>

        <DataTemplate x:Key="RuleTemplate">
            <Border Background="#252526" BorderBrush="#3E3E42" BorderThickness="0,0,0,1" Margin="0,1" Padding="5">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="1.5*"/>
                        <ColumnDefinition Width="0.6*"/>
                        <ColumnDefinition Width="1.5*"/>
                        <ColumnDefinition Width="1.2*"/>
                        <ColumnDefinition Width="2*"/>
                        <ColumnDefinition Width="30"/>
                    </Grid.ColumnDefinitions>

                    <TextBlock Text="ÉS" VerticalAlignment="Center" Foreground="#007ACC" FontWeight="Bold" Margin="0,0,10,0"/>

                    <ComboBox Grid.Column="1" ItemsSource="{Binding DataContext.AvailableIndicators, RelativeSource={RelativeSource AncestorType=Window}}"
                              SelectedItem="{Binding LeftIndicatorName}" Margin="0,0,5,0"/>
                    <TextBox Grid.Column="2" Text="{Binding LeftPeriod}" Margin="0,0,10,0" ToolTip="Periódus"/>

                    <ComboBox Grid.Column="3" ItemsSource="{Binding DataContext.AvailableOperators, RelativeSource={RelativeSource AncestorType=Window}}"
                              SelectedItem="{Binding Operator}" Margin="0,0,10,0"/>

                    <ComboBox Grid.Column="4" ItemsSource="{Binding DataContext.AvailableSourceTypes, RelativeSource={RelativeSource AncestorType=Window}}"
                              SelectedItem="{Binding RightSourceType}" Margin="0,0,10,0"/>

                    <Grid Grid.Column="5">
                        <TextBox Text="{Binding RightValue}" Visibility="{Binding IsRightSideIndicator, Converter={StaticResource InverseBoolToVisibilityConverter}}"/>
                        <StackPanel Orientation="Horizontal" Visibility="{Binding IsRightSideIndicator, Converter={StaticResource BoolToVisibilityConverter}}">
                            <ComboBox ItemsSource="{Binding AllowedRightIndicators}" SelectedItem="{Binding RightIndicatorName}" Width="100" Margin="0,0,5,0"/>
                            <TextBox Text="{Binding RightPeriod}" Width="40"/>
                        </StackPanel>
                    </Grid>

                    <Button Grid.Column="6" Content="🗑" Background="Transparent" BorderThickness="0" Foreground="#FF5555"
                            Command="{Binding DataContext.RemoveRuleCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                            CommandParameter="{Binding}"/>
                </Grid>
            </Border>
        </DataTemplate>

        <DataTemplate x:Key="GroupTemplate">
            <Border Background="#2D2D30" BorderBrush="#555" BorderThickness="1" CornerRadius="5" Margin="0,0,0,15" Padding="10">
                <StackPanel>
                    <Grid Margin="0,0,0,10">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="VAGY" FontWeight="Bold" Foreground="#FFD700" VerticalAlignment="Center" Margin="0,0,10,0" FontSize="14"/>
                            <TextBlock Text="Csoport Neve:" VerticalAlignment="Center" Foreground="Gray" Margin="0,0,5,0"/>
                            <TextBox Text="{Binding Name}" Width="200" Background="#1E1E1E" Foreground="White" BorderBrush="#3E3E42"/>
                        </StackPanel>
                        <Button Grid.Column="1" Content="🗑 Csoport Törlése" 
                                Background="Transparent" BorderThickness="0" Foreground="#FF5555" FontWeight="Bold"
                                Command="{Binding DataContext.RemoveGroupCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                CommandParameter="{Binding}"/>
                    </Grid>

                    <ItemsControl ItemsSource="{Binding Rules}" ItemTemplate="{StaticResource RuleTemplate}"/>

                    <Button Content="+ ÉS Szabály hozzáadása" 
                            HorizontalAlignment="Left" Margin="30,5,0,0" Padding="10,2"
                            Background="Transparent" BorderBrush="#007ACC" Foreground="#007ACC" BorderThickness="1"
                            Command="{Binding DataContext.AddRuleToGroupCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                            CommandParameter="{Binding}"/>
                </StackPanel>
            </Border>
        </DataTemplate>
    </Window.Resources>

    <Grid Margin="15">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <StackPanel Grid.Row="0" Margin="0,0,0,10">
            <TextBlock Text="Stratégia Szerkesztő (Logikai Mód)" FontSize="22" FontWeight="Bold" Foreground="White"/>
            <TextBlock Text="A csoportok között VAGY kapcsolat, a csoportokon belül ÉS kapcsolat van." Foreground="Gray" FontStyle="Italic"/>
        </StackPanel>

        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="20"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <GroupBox Grid.Column="0" Header="Vételi Setupok (Entry)" BorderBrush="LimeGreen" Foreground="LimeGreen">
                <DockPanel>
                    <Button DockPanel.Dock="Bottom" Content="+ Új Vételi Csoport (Setup)" 
                            Command="{Binding AddEntryGroupCommand}"
                            Background="#2D2D30" Foreground="LimeGreen" Margin="0,10,0,0" Padding="10" FontWeight="Bold"/>

                    <ScrollViewer VerticalScrollBarVisibility="Auto">
                        <ItemsControl ItemsSource="{Binding EntryGroups}" ItemTemplate="{StaticResource GroupTemplate}">
                        </ItemsControl>
                    </ScrollViewer>
                </DockPanel>
            </GroupBox>

            <GroupBox Grid.Column="2" Header="Eladási Setupok (Exit)" BorderBrush="Red" Foreground="Red">
                <DockPanel>
                    <Button DockPanel.Dock="Bottom" Content="+ Új Eladási Csoport (Setup)" 
                            Command="{Binding AddExitGroupCommand}"
                            Background="#2D2D30" Foreground="Red" Margin="0,10,0,0" Padding="10" FontWeight="Bold"/>

                    <ScrollViewer VerticalScrollBarVisibility="Auto">
                        <ItemsControl ItemsSource="{Binding ExitGroups}" ItemTemplate="{StaticResource GroupTemplate}"/>
                    </ScrollViewer>
                </DockPanel>
            </GroupBox>
        </Grid>

        <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,15,0,0">
            <Button Content="Mégse" IsCancel="True" Width="80" Height="30" Margin="0,0,10,0" Background="#3E3E42" Foreground="White"/>
            <Button Content="MENTÉS" Command="{Binding SaveCommand}" Width="80" Height="30" Background="#007ACC" Foreground="White" FontWeight="Bold"/>
        </StackPanel>
    </Grid>
</Window>